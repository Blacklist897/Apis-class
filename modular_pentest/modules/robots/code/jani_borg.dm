/*
		JANITOR MODULES
*/

/obj/item/robot_module/janitor
	name = "Janitor"
	basic_modules = list(
		/obj/item/assembly/flash/cyborg,
		/obj/item/screwdriver/cyborg,
		/obj/item/crowbar/cyborg,
		/obj/item/stack/tile/plasteel/cyborg,
		/obj/item/soap/nanotrasen,
		/obj/item/storage/bag/trash/cyborg,
		/obj/item/melee/flyswatter,
		/obj/item/extinguisher/mini,
		/obj/item/mop/cyborg,
		/obj/item/reagent_containers/glass/bucket,
		/obj/item/paint/paint_remover,
		/obj/item/lightreplacer/cyborg,
		/obj/item/holosign_creator/janibarrier,
		/obj/item/reagent_containers/spray/cyborg_drying)
	emag_modules = list(/obj/item/reagent_containers/spray/cyborg_lube)
	cyborg_base_icon = "janitor"
	moduleselect_icon = "janitor"
	hat_offset = -5
	clean_on_move = TRUE

/obj/item/robot_module/janitor/be_transformed_to(obj/item/robot_module/old_module)
	var/mob/living/silicon/robot/R = loc
	var/static/list/jan_icons
	if(!jan_icons)
		jan_icons = list(
		"Antique" = image(icon = 'icons/mob/robots.dmi', icon_state = "janbot"),
		"Mechaduster" = image(icon = 'icons/mob/robots.dmi', icon_state = "mechaduster"),
		"HAN-D" = image(icon = 'icons/mob/robots.dmi', icon_state = "han-d"),
		"Default" = image(icon = 'icons/mob/robots.dmi', icon_state = "janitor"),
		"Droid - 'Mopbot'" = image(icon = 'icons/mob/robots.dmi', icon_state = "droid-janitor"),
		"Marina" = image(icon = 'icons/mob/robots.dmi', icon_state = "marinaJN"),
		"Sleek" = image(icon = 'icons/mob/robots.dmi', icon_state = "sleekjanitor"),
		"Noble" = image(icon = 'icons/mob/robots.dmi', icon_state = "Noble-JAN"),
		"R34 - CUS3a 'Flynn'" = image(icon = 'icons/mob/robots.dmi', icon_state = "flynn"),
		"Meka Janitor - F" = image(icon = 'modular_pentest/modules/robots/icons/mob/numekasf.dmi', icon_state = "fmekajani"),
		"Meka Janitor - M" = image(icon = 'modular_pentest/modules/robots/icons/mob/numekasm.dmi', icon_state = "mmekajani"),
		)
		jan_icons = sortList(jan_icons)
	var/jan_borg_icon = show_radial_menu(R, R , jan_icons, custom_check = CALLBACK(src, PROC_REF(check_menu), R), radius = 42, require_near = TRUE)
	switch(jan_borg_icon)
		if("Antique")
			cyborg_base_icon = "janbot"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "janbot"
		if("Mechaduster")
			cyborg_base_icon = "mechaduster"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "mechaduster"
		if("HAN-D")
			cyborg_base_icon = "han-d"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "han-d"
		if("Default")
			cyborg_base_icon = "janitor"
		if("Droid - 'Mopbot'")
			cyborg_base_icon = "droid-janitor"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "droid-janitor"
		if("Marina")
			cyborg_base_icon = "marinaJN"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "marinaJN"
		if("Sleek")
			cyborg_base_icon = "sleekjanitor"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "sleekjanitor"
		if("Noble")
			cyborg_base_icon = "Noble-JAN"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "Noble-JAN"
		if("R34 - CUS3a 'Flynn'")
			cyborg_base_icon = "flynn"
			cyborg_icon_override = 'icons/mob/robots.dmi'
			special_light_key = "flynn"
		if("Meka Janitor - F")
			cyborg_base_icon = "fmekajani"
			cyborg_icon_override = 'modular_pentest/modules/robots/icons/mob/numekasf.dmi'
			special_light_key = "fmekajani"
		if("Meka Janitor - M")
			cyborg_base_icon = "mmekajani"
			cyborg_icon_override = 'modular_pentest/modules/robots/icons/mob/numekasm.dmi'
			special_light_key = "mmekajani"
		else
			return FALSE
	return ..()

/obj/item/reagent_containers/spray/cyborg_drying
	name = "drying agent spray"
	color = "#A000A0"
	list_reagents = list(/datum/reagent/drying_agent = 250)

/obj/item/reagent_containers/spray/cyborg_lube
	name = "lube spray"
	list_reagents = list(/datum/reagent/lube = 250)

/obj/item/robot_module/janitor/respawn_consumable(mob/living/silicon/robot/R, coeff = 1)
	..()
	var/obj/item/lightreplacer/LR = locate(/obj/item/lightreplacer) in basic_modules
	if(LR)
		for(var/i in 1 to coeff)
			LR.Charge(R)

	var/obj/item/reagent_containers/spray/cyborg_drying/CD = locate(/obj/item/reagent_containers/spray/cyborg_drying) in basic_modules
	if(CD)
		CD.reagents.add_reagent(/datum/reagent/drying_agent, 5 * coeff)

	var/obj/item/reagent_containers/spray/cyborg_lube/CL = locate(/obj/item/reagent_containers/spray/cyborg_lube) in emag_modules
	if(CL)
		CL.reagents.add_reagent(/datum/reagent/lube, 2 * coeff)

//
// TRASH BAG OF HOLDING - BOARD AND UPGRADE CODE
//

/obj/item/borg/upgrade/tboh
	name = "janitor cyborg trash bag of holding"
	desc = "A trash bag of holding replacement for the janiborg's standard trash bag."
	icon_state = "module_janitor"
	require_module = 1
	model_type = list(/obj/item/robot_module/janitor)

/obj/item/borg/upgrade/tboh/action(mob/living/silicon/robot/R)
	. = ..()
	if(.)
		for(var/obj/item/storage/bag/trash/cyborg/TB in R.module.modules)
			R.module.remove_module(TB, TRUE)

		var/obj/item/storage/bag/trash/bluespace/cyborg/B = new /obj/item/storage/bag/trash/bluespace/cyborg(R.module)
		R.module.basic_modules += B
		R.module.add_module(B, FALSE, TRUE)

/obj/item/borg/upgrade/tboh/deactivate(mob/living/silicon/robot/R, user = usr)
	. = ..()
	if(.)
		for(var/obj/item/storage/bag/trash/bluespace/cyborg/B in R.module.modules)
			R.module.remove_module(B, TRUE)

		var/obj/item/storage/bag/trash/cyborg/TB = new (R.module)
		R.module.basic_modules += TB
		R.module.add_module(TB, FALSE, TRUE)

//
// ADVANCED MOP - BOARD AND UPGRADE CODE
//

/obj/item/borg/upgrade/amop
	name = "janitor cyborg advanced mop"
	desc = "An advanced mop replacement for the janiborg's standard mop."
	icon_state = "module_janitor"
	require_module = 1
	model_type = list(/obj/item/robot_module/janitor)

/obj/item/borg/upgrade/amop/action(mob/living/silicon/robot/R)
	. = ..()
	if(.)
		for(var/obj/item/mop/cyborg/M in R.module.modules)
			R.module.remove_module(M, TRUE)

	var/obj/item/mop/advanced/cyborg/A = new /obj/item/mop/advanced/cyborg(R.module)
	R.module.basic_modules += A
	R.module.add_module(A, FALSE, TRUE)

/obj/item/borg/upgrade/amop/deactivate(mob/living/silicon/robot/R, user = usr)
	. = ..()
	if(.)
		for(var/obj/item/mop/advanced/cyborg/A in R.module.modules)
			R.module.remove_module(A, TRUE)

		var/obj/item/mop/cyborg/M = new (R.module)
		R.module.basic_modules += M
		R.module.add_module(M, FALSE, TRUE)
